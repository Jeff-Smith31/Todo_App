Resolving InstanceId and API domain from stack ttt-backend in us-east-1 ...
InstanceId: i-06fa36201fc2da642
ApiDomain: api.ticktocktasks.com
Sending SSM command ...
===== SSM STDOUT =====
=== uname and uptime ===
Linux ip-172-31-50-91.ec2.internal 6.1.150-174.273.amzn2023.x86_64 #1 SMP PREEMPT_DYNAMIC Tue Sep  9 12:21:26 UTC 2025 x86_64 x86_64 x86_64 GNU/Linux
 22:32:21 up 25 min,  0 users,  load average: 0.26, 0.29, 0.20
=== docker version ===
Docker version 25.0.8, build 0bab007
=== docker ps ===
NAMES          IMAGE                  STATUS                    PORTS
ttt-autoheal   willfarrell/autoheal   Up 58 seconds (healthy)
ttt-nginx      nginx:alpine           Up 58 seconds (healthy)   0.0.0.0:80->80/tcp, :::80->80/tcp, 0.0.0.0:443->443/tcp, :::443->443/tcp
ttt-backend    ticktock-backend       Up 3 minutes (healthy)    0.0.0.0:8080->8080/tcp, :::8080->8080/tcp, 0.0.0.0:8443->8443/tcp, :::8443->8443/tcp
=== docker networks ===
NETWORK ID     NAME               DRIVER    SCOPE
287b09788d08   bridge             bridge    local
d32287561600   host               host      local
9abbc51d0e25   none               null      local
d70a1fd5003a   ticktock_default   bridge    local
=== backend container inspect (networks, ip) ===
{"ticktock_default":{"IPAMConfig":null,"Links":null,"Aliases":["ttt-backend","backend","556bebc2790b"],"MacAddress":"02:42:ac:12:00:02","NetworkID":"d70a1fd5003a24b0f488cfcf85b572db78c360ed4155c55076d605c3382f5d97","EndpointID":"b10939e295583cbc87469a0ce74c8fad18e936323dbbeaa8c1718210caa67ad6","Gateway":"172.18.0.1","IPAddress":"172.18.0.2","IPPrefixLen":16,"IPv6Gateway":"","GlobalIPv6Address":"","GlobalIPv6PrefixLen":0,"DriverOpts":null,"DNSNames":["ttt-backend","backend","556bebc2790b"]}}
=== backend container env ===
CERT_HOSTS=localhost
REDIRECT_HTTP_TO_HTTPS=false
CORS_ORIGIN=https://ticktocktasks.com
WEB_PUSH_PUBLIC_KEY=
NODE_ENV=production
HTTPS_PORT=8443
WEB_PUSH_PRIVATE_KEY=
DDB_REGION=
PORT=8080
JWT_SECRET=change-this-in-production
PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin
NODE_VERSION=20.19.5
YARN_VERSION=1.22.22
HTTPS_CERT_PATH=/certs/dev-cert.pem
HTTPS_KEY_PATH=/certs/dev-key.pem
=== listening sockets (80/443/8080/8443) ===
LISTEN 0      4096         0.0.0.0:8443       0.0.0.0:*    users:(("docker-proxy",pid=22345,fd=4))
LISTEN 0      4096         0.0.0.0:80         0.0.0.0:*    users:(("docker-proxy",pid=23902,fd=4))
LISTEN 0      4096         0.0.0.0:443        0.0.0.0:*    users:(("docker-proxy",pid=23882,fd=4))
LISTEN 0      4096         0.0.0.0:8080       0.0.0.0:*    users:(("docker-proxy",pid=22365,fd=4))
LISTEN 0      4096            [::]:8443          [::]:*    users:(("docker-proxy",pid=22350,fd=4))
LISTEN 0      4096            [::]:80            [::]:*    users:(("docker-proxy",pid=23907,fd=4))
LISTEN 0      4096            [::]:443           [::]:*    users:(("docker-proxy",pid=23887,fd=4))
LISTEN 0      4096            [::]:8080          [::]:*    users:(("docker-proxy",pid=22370,fd=4))
=== nginx.conf contents ===
user  nginx;
worker_processes  auto;
error_log  /var/log/nginx/error.log warn;
pid        /var/run/nginx.pid;
events { worker_connections 1024; }
http {
  include       /etc/nginx/mime.types;
  default_type  application/octet-stream;
  sendfile        on;
  keepalive_timeout 65;
  upstream ticktock_backend { server backend:8080; }
  server {
    listen 80;
    server_name api.ticktocktasks.com;
    location ^~ /.well-known/acme-challenge/ { root /var/www/certbot; default_type "text/plain"; }
    return 301 https://$host$request_uri;
  }
  server {
    listen 443 ssl http2;
    server_name api.ticktocktasks.com;
    ssl_certificate /etc/letsencrypt/live/api.ticktocktasks.com/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/api.ticktocktasks.com/privkey.pem;
    ssl_protocols TLSv1.2 TLSv1.3;
    ssl_ciphers HIGH:!aNULL:!MD5;
    location = /healthz { proxy_set_header Host $host; proxy_pass http://ticktock_backend/healthz; }
    location / {
      proxy_set_header Host $host;
      proxy_set_header X-Real-IP $remote_addr;
      proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
      proxy_set_header X-Forwarded-Proto $scheme;
      proxy_pass http://ticktock_backend;
    }
  }
}
=== docker compose ps (if available) ===
NAME           IMAGE                  COMMAND                  SERVICE    CREATED              STATUS                    PORTS
ttt-autoheal   willfarrell/autoheal   "/docker-entrypoint …"   autoheal   About a minute ago   Up 58 seconds (healthy)
ttt-backend    ticktock-backend       "docker-entrypoint.s…"   backend    2 hours ago          Up 3 minutes (healthy)    0.0.0.0:8080->8080/tcp, :::8080->8080/tcp, 0.0.0.0:8443->8443/tcp, :::8443->8443/tcp
ttt-nginx      nginx:alpine           "/docker-entrypoint.…"   nginx      About a minute ago   Up 58 seconds (healthy)   0.0.0.0:80->80/tcp, :::80->80/tcp, 0.0.0.0:443->443/tcp, :::443->443/tcp
=== local backend health http://localhost:8080/healthz ===
{"ok":true}=== local nginx vhost health https://127.0.0.1/healthz ===
{"ok":true}=== last 120 lines nginx logs (if present) ===
/docker-entrypoint.sh: /docker-entrypoint.d/ is not empty, will attempt to perform configuration
/docker-entrypoint.sh: Looking for shell scripts in /docker-entrypoint.d/
/docker-entrypoint.sh: Launching /docker-entrypoint.d/10-listen-on-ipv6-by-default.sh
10-listen-on-ipv6-by-default.sh: info: Getting the checksum of /etc/nginx/conf.d/default.conf
10-listen-on-ipv6-by-default.sh: info: Enabled listen on IPv6 in /etc/nginx/conf.d/default.conf
/docker-entrypoint.sh: Sourcing /docker-entrypoint.d/15-local-resolvers.envsh
/docker-entrypoint.sh: Launching /docker-entrypoint.d/20-envsubst-on-templates.sh
/docker-entrypoint.sh: Launching /docker-entrypoint.d/30-tune-worker-processes.sh
/docker-entrypoint.sh: Configuration complete; ready for start up
2025/09/16 22:31:27 [warn] 1#1: the "listen ... http2" directive is deprecated, use the "http2" directive instead in /etc/nginx/nginx.conf:19
172.18.0.1 - - [16/Sep/2025:22:31:27 +0000] "GET /healthz HTTP/2.0" 200 11 "-" "curl/8.11.1"
172.18.0.1 - - [16/Sep/2025:22:31:27 +0000] "GET /healthz HTTP/2.0" 200 11 "-" "curl/8.11.1"
127.0.0.1 - - [16/Sep/2025:22:31:53 +0000] "GET /healthz HTTP/1.1" 200 11 "-" "Wget"
172.18.0.1 - - [16/Sep/2025:22:32:21 +0000] "GET /healthz HTTP/2.0" 200 11 "-" "curl/8.11.1"
=== last 120 lines backend logs ===
    at wrappedValidations.<computed> [as xForwardedForHeader] (file:///app/node_modules/express-rate-limit/dist/index.mjs:369:22)
    at Object.keyGenerator (file:///app/node_modules/express-rate-limit/dist/index.mjs:630:20)
    at file:///app/node_modules/express-rate-limit/dist/index.mjs:682:32
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async file:///app/node_modules/express-rate-limit/dist/index.mjs:663:5 {
  code: 'ERR_ERL_UNEXPECTED_X_FORWARDED_FOR',
  help: 'https://express-rate-limit.github.io/ERR_ERL_UNEXPECTED_X_FORWARDED_FOR/'
}
/app/node_modules/@smithy/config-resolver/dist-cjs/index.js:115
    throw new Error("Region is missing");
          ^
Error: Region is missing
    at default (/app/node_modules/@smithy/config-resolver/dist-cjs/index.js:115:11)
    at /app/node_modules/@smithy/node-config-provider/dist-cjs/index.js:90:104
    at /app/node_modules/@smithy/property-provider/dist-cjs/index.js:99:33
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async coalesceProvider (/app/node_modules/@smithy/property-provider/dist-cjs/index.js:126:18)
    at async /app/node_modules/@smithy/property-provider/dist-cjs/index.js:137:20
    at async region (/app/node_modules/@smithy/config-resolver/dist-cjs/index.js:139:30)
    at async Object.defaultDynamoDBHttpAuthSchemeParametersProvider [as httpAuthSchemeParametersProvider] (/app/node_modules/@aws-sdk/client-dynamodb/dist-cjs/auth/httpAuthSchemeProvider.js:9:18)
    at async /app/node_modules/@smithy/core/dist-cjs/index.js:88:5
    at async /app/node_modules/@aws-sdk/middleware-logger/dist-cjs/index.js:33:22
Node.js v20.19.5
DynamoDB ensureTables failed Error: Region is missing
    at default (/app/node_modules/@smithy/config-resolver/dist-cjs/index.js:115:11)
    at /app/node_modules/@smithy/node-config-provider/dist-cjs/index.js:90:104
    at /app/node_modules/@smithy/property-provider/dist-cjs/index.js:99:33
TickTock Tasks HTTPS server listening on :8443
TickTock Tasks HTTP server listening on :8080 (no redirect)
PROPFIND / 404 5.589 ms - 144
GET /healthz 200 2.849 ms - 11
GET /healthz 200 0.650 ms - 11
GET /healthz 200 0.410 ms - 11
GET /healthz 200 0.407 ms - 11
GET /healthz 200 0.546 ms - 11
GET /healthz 200 0.416 ms - 11
GET /healthz 200 0.401 ms - 11
GET /healthz 200 0.389 ms - 11
GET /healthz 200 0.524 ms - 11
GET /healthz 200 0.585 ms - 11
GET /healthz 200 0.440 ms - 11
GET /healthz 200 0.335 ms - 11
GET /healthz 200 0.556 ms - 11
GET /healthz 200 0.449 ms - 11
GET /healthz 200 0.402 ms - 11
GET /healthz 200 0.518 ms - 11
GET /healthz 200 0.388 ms - 11
GET /healthz 200 0.278 ms - 11
GET /healthz 200 0.378 ms - 11
GET /healthz 200 0.398 ms - 11
GET /healthz 200 0.408 ms - 11
GET /healthz 200 0.383 ms - 11
GET /healthz 200 0.402 ms - 11
GET /healthz 200 0.376 ms - 11
GET /healthz 200 0.350 ms - 11
GET /healthz 200 0.338 ms - 11
GET /healthz 200 0.276 ms - 11
GET /healthz 200 0.347 ms - 11
GET /healthz 200 0.334 ms - 11
GET /healthz 200 0.365 ms - 11
GET /healthz 200 0.269 ms - 11
GET /healthz 200 0.367 ms - 11
GET /healthz 200 0.347 ms - 11
GET /healthz 200 0.350 ms - 11
GET /healthz 200 0.569 ms - 11
GET /healthz 200 0.361 ms - 11
GET /healthz 200 0.351 ms - 11
GET /healthz 200 0.298 ms - 11
GET /healthz 200 0.353 ms - 11
GET /api/ping 200 0.530 ms - 85
GET /healthz 200 0.352 ms - 11
GET /healthz 200 0.454 ms - 11
ValidationError: The 'X-Forwarded-For' header is set but the Express 'trust proxy' setting is false (default). This could indicate a misconfiguration which would prevent express-rate-limit from accurately identifying users. See https://express-rate-limit.github.io/ERR_ERL_UNEXPECTED_X_FORWARDED_FOR/ for more information.
    at Object.xForwardedForHeader (file:///app/node_modules/express-rate-limit/dist/index.mjs:157:13)
    at wrappedValidations.<computed> [as xForwardedForHeader] (file:///app/node_modules/express-rate-limit/dist/index.mjs:369:22)
    at Object.keyGenerator (file:///app/node_modules/express-rate-limit/dist/index.mjs:630:20)
    at file:///app/node_modules/express-rate-limit/dist/index.mjs:682:32
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async file:///app/node_modules/express-rate-limit/dist/index.mjs:663:5 {
  code: 'ERR_ERL_UNEXPECTED_X_FORWARDED_FOR',
  help: 'https://express-rate-limit.github.io/ERR_ERL_UNEXPECTED_X_FORWARDED_FOR/'
}
/app/node_modules/@smithy/config-resolver/dist-cjs/index.js:115
    throw new Error("Region is missing");
          ^
Error: Region is missing
    at default (/app/node_modules/@smithy/config-resolver/dist-cjs/index.js:115:11)
    at /app/node_modules/@smithy/node-config-provider/dist-cjs/index.js:90:104
    at /app/node_modules/@smithy/property-provider/dist-cjs/index.js:99:33
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async coalesceProvider (/app/node_modules/@smithy/property-provider/dist-cjs/index.js:126:18)
    at async /app/node_modules/@smithy/property-provider/dist-cjs/index.js:137:20
    at async region (/app/node_modules/@smithy/config-resolver/dist-cjs/index.js:139:30)
    at async Object.defaultDynamoDBHttpAuthSchemeParametersProvider [as httpAuthSchemeParametersProvider] (/app/node_modules/@aws-sdk/client-dynamodb/dist-cjs/auth/httpAuthSchemeProvider.js:9:18)
    at async /app/node_modules/@smithy/core/dist-cjs/index.js:88:5
    at async /app/node_modules/@aws-sdk/middleware-logger/dist-cjs/index.js:33:22
Node.js v20.19.5
DynamoDB ensureTables failed Error: Region is missing
    at default (/app/node_modules/@smithy/config-resolver/dist-cjs/index.js:115:11)
    at /app/node_modules/@smithy/node-config-provider/dist-cjs/index.js:90:104
    at /app/node_modules/@smithy/property-provider/dist-cjs/index.js:99:33
TickTock Tasks HTTPS server listening on :8443
TickTock Tasks HTTP server listening on :8080 (no redirect)
GET /healthz 200 4.704 ms - 11
GET /healthz 200 0.881 ms - 11
GET /healthz 200 0.540 ms - 11
GET /healthz 200 0.455 ms - 11
GET /healthz 200 0.416 ms - 11
GET /healthz 200 0.436 ms - 11
GET /healthz 200 0.431 ms - 11
GET /healthz 200 0.332 ms - 11
GET /healthz 200 0.414 ms - 11
GET /healthz 200 0.634 ms - 11
GET /healthz 200 0.489 ms - 11
GET /healthz 200 0.399 ms - 11
GET /healthz 200 0.723 ms - 11
===== SSM STDERR =====
docker: 'compose' is not a docker command.
See 'docker --help'
time="2025-09-16T22:32:21Z" level=warning msg="The \"WEB_PUSH_PUBLIC_KEY\" variable is not set. Defaulting to a blank string."
time="2025-09-16T22:32:21Z" level=warning msg="The \"WEB_PUSH_PRIVATE_KEY\" variable is not set. Defaulting to a blank string."
time="2025-09-16T22:32:21Z" level=warning msg="/opt/ticktock/docker-compose.yml: `version` is obsolete"
time="2025-09-16T22:32:21Z" level=warning msg="/opt/ticktock/docker-compose.override.yml: `version` is obsolete"
